# 手写RPC框架

## RPC通信原理

RPC又叫远程过程调用，它的核心原理是在分布式系统中的函数调用中，隐藏网络通信的细节，使得开发者可以像调用本地函数一样调用远程服务。

我们先从传统的单机和集群聊天服务器讲起

1. 单机服务器

![single](res/单机%20(2).png)

2. 集群服务器

为了弥补单机服务器的缺陷，自然能想到集群服务器，一个服务器不行，那我们就多弄几个

![multi](res/集群.png)

每一个服务器都有一套独立的管理系统，这种架构的优点很明显
- 并发量提升
- 每台服务器都是一个独立的服务，如果中间某台挂掉也不会影响业务
- 部署简单，一台机器与多台机器部署方式相同，如果临时需要增大并发量可以直接部署

但是缺点也比较明显：
- ，比如只修改一个小的地方，但是全部代码都需要重新编译一遍，因为模块未分开部署。
- 系统中有些模块属于CPU密集型，有些属于IO密集型，资源需求不一致，但是各个模块捆包在一起浪费资源

3. 分布式系统

![multi](res/分布式.png)

把各个模块分开，独立成单独的服务，每个模块独立部署在不同机器上，所有服务共同构成一个系统，给客户端提供服务

分布式系统灵活的点在于

- 可以根据模块的特点配备特定的硬件设备，比如CPU密集型或者IO密集型
- 对应需求量高的任务可以做成服务集群，提高并发量

在分布式系统中，比如server1调用server2的方法，内部是通过远程调用，但是通过RPC框架将这些远程的调用细节封装起来，变得像本地调用一样方便。

4. rpc通信原理

![multi](res/process%20(2).png)
图中红框内的部分就是rpc框架的作用，将通信细节封装起来

**黄色部分**：设计rpc方法参数的打包和解析，也就是数据的序列化和反序列化，使用Protobuf

**绿色部分**：网络部分，包括寻找rpc服务主机，发起rpc调用请求和响应rpc调用结果，使用muduo网络库和zookeeper服务配置中心（专门做服务发现）

## protobuf


## 从使用角度理解框架的功能

